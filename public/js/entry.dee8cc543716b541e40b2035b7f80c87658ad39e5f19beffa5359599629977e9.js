(()=>{(function(){let r=window.FOLKLORE_ENTRY;if(!r)return;let p=document.getElementById("back-to-map"),l=document.getElementById("related-places");if(p){let t=document.referrer,a=(r.base||"/").replace(/\/$/,"");try{let c=new URL(t),s=c.pathname.replace(/\/$/,"")||"/";(s==="/map"||s.endsWith("/map"))&&c.search&&(p.href=a+"/map"+c.search)}catch{}}let d=r.indexUrl||(r.base||"")+"map/index.json";fetch(d,{cache:"default"}).then(function(t){return t.json()}).then(function(t){let a=new Set((r.tags||[]).map(function(e){return String(e).toLowerCase()})),c=r.slug,s=t.filter(function(e){return((e.url||"").split("/").filter(Boolean).pop()||"")!==c}).map(function(e){let n=(e.tags||[]).map(function(u){return String(u).toLowerCase()}),o=0;return n.forEach(function(u){a.has(u)&&o++}),{entry:e,shared:o}}).filter(function(e){return e.shared>0}).sort(function(e,n){return n.shared!==e.shared?n.shared-e.shared:(e.entry.title||"").localeCompare(n.entry.title||"")}).slice(0,6).map(function(e){return e.entry});if(s.length===0){l.innerHTML='<p class="related-none">No related places with shared tags.</p>';return}l.innerHTML='<ul class="related-list" role="list">'+s.map(function(e){let n=(e.tags||[]).slice(0,3).map(function(o){return'<span class="tag-chip tag-chip-small">'+i(o)+"</span>"}).join("");return'<li><a href="'+f(e.url)+'">'+i(e.title)+"</a>"+(e.county?' <span class="related-county">'+i(e.county)+"</span>":"")+(n?' <div class="related-tags">'+n+"</div>":"")+"</li>"}).join("")+"</ul>"}).catch(function(){l.innerHTML='<p class="related-none">Unable to load related places.</p>'});function i(t){let a=document.createElement("div");return a.textContent=t,a.innerHTML}function f(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}})();})();
